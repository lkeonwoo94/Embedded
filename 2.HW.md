Hardware를 다룹니다

1. MCU-CPU-Core 차이
2. Co-Processor
3. Memory
3-1. Cash-Memory
3-2. NOR Flash
3-3. NAND Flash
3-4. SDRAM
4. Interrupt
5. JTAG
6. Serial Port
7. LCD
8. ARM

## 1. MCU-CPU-Core 차이
**Core** = Register Bank + ALU + Barrel Shifter + Multiplier     
**Processor(CPU)** = **Core** + Co-processor, MMU, Cache Memory    
**MCU** = **CPU** + Memory-Controller + GPIO , LCD, Sound ... **(Peripheral)**
```
+-MCU--------------------------------------------------------------------------------------------------------------+
|                                                                                                                  |
|    +-CPU------------------------------------------------------------------------------------+     +-----------+  |
|    |                                                                                        |     |    GPIO   |  |
|    |     +-Core--------------------------------+           +--------------+                 |     +-----------+  |
|    |     |                                     |   <=====> | Co-Processor |                 |                    |
|    |     |  +-----+  +----------+  +---------+ |           +--------------+                 |     +-----------+  |
|    |     |  | ALU |  | Register |  | Shifter | |                    |                       |     | Serial-   |  | ------ +--------+
|    |     |  +-----+  +----------+  +---------+ |                    |                       |     | Controller|  |        | Serial |
|    |     +-------------------------------------+                    |                       |     +-----------+  | ------ +--------+
|    |            ^   ^               ^   ^                           |                       |                    |
|    |      addr  |   | data    addr  |   | data                      V                       |     +-----------+  | ------ +--------+
|    |      line  |   | line    line  |   | line        addr-line +-------+                   |     | NAND -    |  |        |  NAND  |
|    |            |   |               |---|-----------------=-----|  MMU  |                   |     | Controller|  | ------ +--------+
|    |            |---|---------------|---|-----------------------+-------+                   |     +-----------+  |
|    |            v   v               v   v             addr-line    ^                        |                    |
|    |     +-Cache-------------------------------+                   ↓                        |     +-----------+  |
|    |     |                                     |   ...--------- +--------+ --------Bus ...  |     |   Etc..   |  |
|    |     |  +------------+     +------------+  |      data-line | buffer |                  |     +-----------+  |
|    |     |  |   I-Cache  |     |   D-Cache  |  |   ...--------- +--------+ --------Bus ...  |                    |
|    |     |  +------------+     +------------+  |      data-line                             |                    |
|    |     +-------------------------------------+                                            |                    |
|    |                                                                                        |                    |
|    +----------------------------------------------------------------------------------------+                    |
|                                                                                                                  |
+------------------------------------------------------------------------------------------------------------------+
```
> Process Routine
① Core가 Memory를 Read
② Read한 Code를 **Core**가 기계어 번역 後 Execute 

> MMU
" 가상주소 - 물리주소 연결 역할 " (32bit processor의 경우, 2^32 = 4GB 까지 메모리 표현)

> Co-Processor
" CP15"  - MMU, Cache **Enable/Disable**
CP15는 15개의 Register로 구성
**CR Register** : I(I-cache) / C(D-cache) / M (MMU).
**Cache를 사용하려면 반드시 MMU on. (Cache-MMU로 연결되어 있다)**
```
+-----------------------------+
| Core <-> MMU <-> SDRAM(RAM) |  // MMU Page Table
+-----------------------------+
```

> Cache
" ARM은 캐시에 저장하는 방식이 **2**가지 이다"
쓰기정책:
    1. Write Through : 캐시와 SDRAM에 동시 저장
    2. Write Back : 캐시에 우선 저장, 이후 캐시가 Full되면 SDRAM에 저장

교체정책: 캐시쓰레싱(메모리->캐시) 를 줄이기 위해 캐시를 **여러개 사용**. Cache line을 선택하는 정책
할당정책: 캐시교체정책의 타이밍을 결정

> NOR Flash
NOR 특징 : XIP, **쓰기동작 전에 반드시 지워야한다**
NAND 특징 : **반드시 RAM으로 복사 후 Exe (NAND에는 Addr가 없다)** <- **NAND 내부에 부트로더가 존재** 
          : NAND는 주소를 **블럭단위**로 동작한다.
          : NAND는 ECC(베드블럭) 이 존재한다. 한번 베드블럭이 발생하면 다시는 읽고/쓸 수 없다.
          : NAND는 주소가 없어서 **Controller**가 필요하다.
```
가상의 NOR 예제
+-------------------------------------------------------------+
| Cmd   | Bus Cycle |     1st     |     2nd     |     3rd     |
|                   | Addr | Data | Addr | Data | Addr | Data |
---------------------------------------------------------------
| Erase |     3     |  555 |  aa  | AAA  |  55  |  555 |  80  |
+-------------------------------------------------------------+

int main(){
addr16a=(*para+0xaaa);
addr16b=(*para+0x554);
*addr16a=0xaa;
*addr16b=0x55;
*addr16a=0x80;
+--------------------------------------------+

결과 : NOR Flash의 메모리 값이 0xFF 으로 지워짐
```


> SDRAM(RAM)
SDRAM을 사용할 때는 **Memory-Controller** 를 설정해줘야 한다.
일반적으로 Memory-Controller 설정은 **Start-up Code** 에서 어셈블리어로 짠다.
```
분류
SDRAM ----- SDR ( 싱글 데이터)
      ㄴ--- DDR ( 더블 데이터)
```

> Interrupt
부팅 시 Peripheral은 **Interrupt Mode Register**에 Mode가 기록된다.
부팅 후, 인터럽트가 발생하면 **인터럽트 컨트롤러**가 **Mode Register**를 읽어서 **인터럽트 벡터 테이블(IVT)** 로 JMP 시킨다.
벡터 테이블 이후 **ISR**로 가서 실행된다.


ARM core는 **37**개의 Register로 구성


